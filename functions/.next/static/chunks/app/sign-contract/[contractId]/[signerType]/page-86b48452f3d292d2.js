(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1784],{5801:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>y});var s=t(95155),r=t(12115),o=t(35695),n=t(35317),i=t(67039),d=t(66695),l=t(30285),c=t(50172),u=t(40157);let m=(0,u.A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var p=t(15300);let x=(0,u.A)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),h=(0,u.A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var f=t(87481),v=t(6874),g=t.n(v),j=t(83013),b=t(90540);function y(){var e,a,t,u,v,y;let N=(0,o.useParams)();(0,o.useRouter)();let{toast:w}=(0,f.dj)(),k=N.contractId,A=N.signerType,[E,T]=(0,r.useState)(null),[S,D]=(0,r.useState)(!0),[C,I]=(0,r.useState)(null),[P,H]=(0,r.useState)(!1),[M,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!k){I("ID do contrato n\xe3o fornecido."),D(!1);return}if(!["client","witness1","witness2","provider"].includes(A)){I("Tipo de assinante inv\xe1lido na URL."),D(!1);return}(async()=>{D(!0),I(null),O(null);try{let x=(0,n.H9)(i.db,"contratos",k),h=await (0,n.x7)(x);if(h.exists()){var e,a,t,s,r,o,d,l,c,u,m,p;let n,i,x;let f={id:h.id,...h.data()};T(f);let v="";switch(A){case"client":n="cliente",i=null===(e=f.cliente)||void 0===e?void 0:e.nome,x=null===(a=f.cliente)||void 0===a?void 0:a.email,v=i?"Cliente (".concat(i,")"):"Cliente";break;case"witness1":n="testemunha1",i=null===(s=f.testemunhas)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.nome,x=null===(o=f.testemunhas)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:r.email,v=i?"Testemunha 1 (".concat(i,")"):"Testemunha 1";break;case"witness2":n="testemunha2",i=null===(l=f.testemunhas)||void 0===l?void 0:null===(d=l[1])||void 0===d?void 0:d.nome,x=null===(u=f.testemunhas)||void 0===u?void 0:null===(c=u[1])||void 0===c?void 0:c.email,v=i?"Testemunha 2 (".concat(i,")"):"Testemunha 2";break;case"provider":n="prestador",i=(null===(m=f.empresaPrestador)||void 0===m?void 0:m.responsavelTecnico)||(null===(p=f.empresaPrestador)||void 0===p?void 0:p.nome)||"Prestador de Servi\xe7o",v="Prestador (".concat(i,")");break;default:I("Tipo de assinante desconhecido."),D(!1);return}if(!i){I("Detalhes para ".concat(A," n\xe3o encontrados ou n\xe3o aplic\xe1veis neste contrato."));return}O({keyInFirestore:n,name:i,email:x,roleDescription:v})}else I("Contrato n\xe3o encontrado. Verifique o link ou se voc\xea tem permiss\xe3o para acess\xe1-lo.")}catch(e){console.error("Erro ao buscar contrato:",e),I(e.message||"Ocorreu um erro ao buscar o contrato."),w({title:"Erro ao carregar contrato",description:"N\xe3o foi poss\xedvel carregar os dados do contrato.",variant:"destructive"})}finally{D(!1)}})()},[k,A]);let F=()=>{var e;return!!E&&!!M&&!!E.assinaturas&&!!M.keyInFirestore&&!!(null===(e=E.assinaturas[M.keyInFirestore])||void 0===e?void 0:e.dataHora)},R=async()=>{if(!E||!E.id||!M||!M.keyInFirestore){w({title:"Erro",description:"Dados do contrato ou informa\xe7\xf5es do assinante ausentes.",variant:"destructive"});return}if(F()){w({title:"J\xe1 Assinado",description:"Este contrato j\xe1 foi assinado por voc\xea.",variant:"default"});return}if("assinado"===E.status||"cancelado"===E.status){w({title:"Contrato Finalizado",description:"Este contrato j\xe1 est\xe1 ".concat(E.status,". N\xe3o pode mais ser assinado."),variant:"default"});return}H(!0);try{var e,a,t,s,r,o,d,l,c;let u=(0,n.H9)(i.db,"contratos",E.id),m={nome:M.name,dataHora:n.Dc.now()};M.email&&(m.email=M.email),M.keyInFirestore;let p={...E.assinaturas||{},[M.keyInFirestore]:m},x="parcialmente_assinado";null===(e=p.cliente)||void 0===e||e.dataHora,null===(a=p.prestador)||void 0===a||a.dataHora,E.testemunhas&&E.testemunhas.length>0&&(null===(o=p.testemunha1)||void 0===o||o.dataHora,E.testemunhas.length>1&&(null===(d=p.testemunha2)||void 0===d||d.dataHora));let h=2,f=0;(null===(t=p.cliente)||void 0===t?void 0:t.dataHora)&&f++,(null===(s=p.prestador)||void 0===s?void 0:s.dataHora)&&f++,(null===(r=E.testemunhas)||void 0===r?void 0:r.length)&&(h+=E.testemunhas.length,(null===(l=p.testemunha1)||void 0===l?void 0:l.dataHora)&&f++,E.testemunhas.length>1&&(null===(c=p.testemunha2)||void 0===c?void 0:c.dataHora)&&f++),f===h&&(x="assinado");let v={assinaturas:p,status:x,dataUltimaModificacao:n.Dc.now()};"assinado"===x&&(v.dataFinalizacaoAssinaturas=n.Dc.now()),await (0,n.mZ)(u,v),T(e=>e?{...e,assinaturas:p,status:x,dataUltimaModificacao:v.dataUltimaModificacao,dataFinalizacaoAssinaturas:"assinado"===x?v.dataFinalizacaoAssinaturas:e.dataFinalizacaoAssinaturas}:null),w({title:"Contrato Assinado!",description:"Obrigado, ".concat(M.name,". Sua assinatura foi registrada.")})}catch(a){console.error("Erro ao assinar contrato:",a);let e="N\xe3o foi poss\xedvel registrar sua assinatura.";"permission-denied"===a.code?e="Voc\xea n\xe3o tem permiss\xe3o para assinar este contrato ou a opera\xe7\xe3o foi bloqueada pelas regras de seguran\xe7a. Verifique se est\xe1 logado com o e-mail correto ou se o contrato permite sua assinatura.":a.message&&(e=a.message),w({title:"Erro ao Assinar",description:e,variant:"destructive"})}finally{H(!1)}};return S?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center min-h-screen bg-background p-4",children:[(0,s.jsx)(c.A,{className:"h-12 w-12 animate-spin text-primary mb-4"}),(0,s.jsx)("p",{className:"text-lg text-muted-foreground",children:"Carregando contrato..."})]}):C?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background p-4",children:(0,s.jsxs)(d.Zp,{className:"w-full max-w-lg text-center",children:[(0,s.jsx)(d.aR,{children:(0,s.jsxs)(d.ZB,{className:"flex items-center justify-center text-destructive",children:[(0,s.jsx)(m,{className:"mr-2 h-6 w-6"})," Erro ao Carregar Contrato"]})}),(0,s.jsx)(d.Wu,{children:(0,s.jsx)("p",{className:"text-muted-foreground",children:C})}),(0,s.jsx)(d.wL,{children:(0,s.jsx)(l.$,{asChild:!0,className:"w-full",children:(0,s.jsx)(g(),{href:"/dashboard",children:"Voltar ao Painel"})})})]})}):E&&M?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background p-4",children:(0,s.jsxs)(d.Zp,{className:"w-full max-w-2xl",children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsxs)(d.ZB,{className:"flex items-center text-2xl",children:[(0,s.jsx)(p.A,{className:"mr-3 h-7 w-7 text-primary"}),"Assinatura de Contrato Digital"]}),(0,s.jsxs)(d.BT,{children:["Contrato para: ",(0,s.jsx)("span",{className:"font-semibold",children:(null===(e=E.cliente)||void 0===e?void 0:e.nome)||"Cliente n\xe3o informado"}),(0,s.jsx)("br",{}),"Tipo: ",(0,s.jsx)("span",{className:"font-semibold",children:"padr\xe3o"===E.tipo?"Padr\xe3o":"Emergencial"}),E.id&&(0,s.jsxs)("span",{className:"block text-xs text-muted-foreground mt-1",children:["ID: ",E.id]})]})]}),(0,s.jsxs)(d.Wu,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"p-4 border rounded-md bg-muted/50",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg mb-1",children:"Sua Fun\xe7\xe3o:"}),(0,s.jsxs)("p",{className:"text-md flex items-center",children:[(0,s.jsx)(x,{size:20,className:"mr-2 text-accent"})," ",M.roleDescription]}),M.email&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground ml-7",children:M.email})]}),(0,s.jsxs)("div",{className:"p-4 border rounded-md max-h-60 overflow-y-auto",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Objeto do Contrato (Resumo):"}),(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:(null===(a=E.blocosEditaveis)||void 0===a?void 0:a.objetoDoContrato)||"Objeto do contrato n\xe3o especificado."}),"emergencial"===E.tipo&&E.termosEmergencial&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t",children:[(0,s.jsx)("h4",{className:"font-semibold text-sm text-amber-700 dark:text-amber-500",children:"Termos Emergenciais Espec\xedficos:"}),(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:E.termosEmergencial}),void 0!==E.taxaDeslocamento&&(0,s.jsxs)("p",{className:"text-sm font-medium mt-1",children:["Taxa de Deslocamento: R$ ",E.taxaDeslocamento.toFixed(2)]})]}),(0,s.jsx)("p",{className:"mt-4 text-xs text-muted-foreground",children:"Este \xe9 um resumo. O documento completo ser\xe1 disponibilizado ap\xf3s todas as assinaturas."})]}),F()?(0,s.jsxs)("div",{className:"p-4 border rounded-md bg-green-100 dark:bg-green-900/70 text-green-700 dark:text-green-300 flex items-center gap-3",children:[(0,s.jsx)(h,{size:24}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold",children:"Este contrato j\xe1 foi assinado por voc\xea."}),(0,s.jsxs)("p",{className:"text-xs",children:["Assinado em: ",(null===(t=E.assinaturas[M.keyInFirestore])||void 0===t?void 0:t.dataHora)?(0,j.GP)(E.assinaturas[M.keyInFirestore].dataHora.toDate(),"dd/MM/yyyy '\xe0s' HH:mm",{locale:b.F}):"Data indispon\xedvel"]})]})]}):(0,s.jsxs)("div",{className:"p-6 border-2 border-dashed border-primary/50 rounded-md text-center space-y-4 bg-background",children:[(0,s.jsx)("h3",{className:"font-semibold text-xl text-primary",children:"Confirmar Assinatura Eletr\xf4nica"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:['Ao clicar em "Assinar Contrato Digitalmente", voc\xea, ',(0,s.jsx)("span",{className:"font-bold",children:M.name}),", declara que leu, compreendeu e concorda com todos os termos e condi\xe7\xf5es do contrato apresentado. Sua assinatura digital ter\xe1 validade jur\xeddica."]}),(0,s.jsx)(l.$,{onClick:R,disabled:P||"assinado"===E.status||"cancelado"===E.status,size:"lg",className:"w-full max-w-xs mx-auto text-base py-6",children:P?(0,s.jsx)(c.A,{className:"mr-2 h-5 w-5 animate-spin"}):"Assinar Contrato Digitalmente"}),"assinado"===E.status&&(0,s.jsx)("p",{className:"text-sm text-green-600 font-medium mt-2",children:"Este contrato j\xe1 foi totalmente assinado."}),"cancelado"===E.status&&(0,s.jsx)("p",{className:"text-sm text-red-600 font-medium mt-2",children:"Este contrato foi cancelado e n\xe3o pode mais ser assinado."})]})]}),(0,s.jsxs)(d.wL,{className:"flex-col items-start text-xs text-muted-foreground space-y-1 pt-4",children:[(0,s.jsxs)("p",{children:["Em caso de d\xfavidas, entre em contato com ",(null===(u=E.empresaPrestador)||void 0===u?void 0:u.nome)||"o prestador de servi\xe7o"," (Email: ",(null===(v=E.empresaPrestador)||void 0===v?void 0:v.email)||(null===(y=E.cliente)||void 0===y?void 0:y.email)||"n\xe3o informado",")."]}),(0,s.jsx)("p",{children:"Powered by ANODE Lite"})]})]})}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background p-4",children:(0,s.jsxs)(d.Zp,{className:"w-full max-w-lg text-center",children:[(0,s.jsx)(d.aR,{children:(0,s.jsxs)(d.ZB,{className:"flex items-center justify-center text-destructive",children:[(0,s.jsx)(m,{className:"mr-2 h-6 w-6"})," Dados Incompletos"]})}),(0,s.jsx)(d.Wu,{children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"N\xe3o foi poss\xedvel carregar os detalhes do contrato ou do assinante. Verifique se o link est\xe1 correto e tente novamente."})}),(0,s.jsx)(d.wL,{children:(0,s.jsx)(l.$,{asChild:!0,className:"w-full",children:(0,s.jsx)(g(),{href:"/dashboard",children:"Voltar ao Painel"})})})]})})}},10183:(e,a,t)=>{Promise.resolve().then(t.bind(t,5801))},15300:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(40157).A)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},30285:(e,a,t)=>{"use strict";t.d(a,{$:()=>l,r:()=>d});var s=t(95155),r=t(12115),o=t(99708),n=t(74466),i=t(59434);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=r.forwardRef((e,a)=>{let{className:t,variant:r,size:n,asChild:l=!1,...c}=e,u=l?o.DX:"button";return(0,s.jsx)(u,{className:(0,i.cn)(d({variant:r,size:n,className:t})),ref:a,...c})});l.displayName="Button"},35695:(e,a,t)=>{"use strict";var s=t(18999);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(a,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(a,{useSearchParams:function(){return s.useSearchParams}})},59434:(e,a,t)=>{"use strict";t.d(a,{cn:()=>o});var s=t(52596),r=t(39688);function o(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,r.QP)((0,s.$)(a))}},66695:(e,a,t)=>{"use strict";t.d(a,{BT:()=>l,Wu:()=>c,ZB:()=>d,Zp:()=>n,aR:()=>i,wL:()=>u});var s=t(95155),r=t(12115),o=t(59434);let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});n.displayName="Card";let i=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",t),...r})});i.displayName="CardHeader";let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});d.displayName="CardTitle";let l=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,o.cn)("text-sm text-muted-foreground",t),...r})});l.displayName="CardDescription";let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,o.cn)("p-6 pt-0",t),...r})});c.displayName="CardContent";let u=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,o.cn)("flex items-center p-6 pt-0",t),...r})});u.displayName="CardFooter"},67039:(e,a,t)=>{"use strict";let s;t.d(a,{IG:()=>c,db:()=>l,hJ:()=>u,j2:()=>d});var r=t(23915),o=t(93004),n=t(35317),i=t(90858);s=(0,r.Dk)().length?(0,r.Sx)():(0,r.Wp)({apiKey:"AIzaSyB6l66mg1YBrpekOLGtSzdsIIlyXsM0ziU",authDomain:"anode-lite.firebaseapp.com",projectId:"anode-lite",storageBucket:"anode-lite.firebasestorage.app",messagingSenderId:"468146694907",appId:"1:468146694907:web:aa60f4e32503ef70401e5e"});let d=(0,o.xI)(s),l=(0,n.aU)(s),c=(0,i.c7)(s),u=new o.HF},87481:(e,a,t)=>{"use strict";t.d(a,{dj:()=>m});var s=t(12115);let r=0,o=new Map,n=e=>{if(o.has(e))return;let a=setTimeout(()=>{o.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,a)},i=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=a;return t?n(t):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}},d=[],l={toasts:[]};function c(e){l=i(l,e),d.forEach(e=>{e(l)})}function u(e){let{...a}=e,t=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function m(){let[e,a]=s.useState(l);return s.useEffect(()=>(d.push(a),()=>{let e=d.indexOf(a);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var a=a=>e(e.s=a);e.O(0,[2992,6073,668,9023,6874,7248,8441,1684,7358],()=>a(10183)),_N_E=e.O()}]);